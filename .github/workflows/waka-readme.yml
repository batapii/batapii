name: Update GitHub Profile README and Generate Mountain

on:
  schedule:
    - cron: "0 9 * * *"
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  update-profile:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      # ... å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯å¤‰æ›´ãªã— ...

      - name: Split WakaTime stats
        run: |
          if [ -f README.md ]; then
            sed -n '/ğŸ± My GitHub Data/,/I'"'"'m an Early ğŸ¤/ w github-data.md' README.md
            sed -n '/I'"'"'m an Early ğŸ¤/,/ğŸ“Š This Week I Spent My Time On/ w coding-habits.md' README.md
            sed -n '/ğŸ“Š This Week I Spent My Time On/,/I Mostly Code in Kotlin/ w weekly-breakdown.md' README.md
            echo "WakaTime stats split completed."
          else
            echo "README.md not found. Cannot split WakaTime stats."
          fi

      - name: Debug WakaTime stats files
        run: |
          for file in github-data.md coding-habits.md weekly-breakdown.md; do
            if [ -f "$file" ]; then
              echo "Contents of $file:"
              cat "$file"
            else
              echo "$file not found."
            fi
          done

      - name: Update README
        run: |
          cat << EOF > README.md
          # My GitHub Profile

          ![Mountain](./mountain-output/mountain.svg)

          ## ğŸ“Š My Coding Insights
          <details>
          <summary><b>Click to view GitHub Data</b></summary>

          $(cat github-data.md || echo "GitHub Data not available")
          </details>

          <details>
          <summary><b>Click to view Coding Habits</b></summary>

          $(cat coding-habits.md || echo "Coding Habits not available")
          </details>

          <details>
          <summary><b>Click to view Weekly Breakdown</b></summary>

          $(cat weekly-breakdown.md || echo "Weekly Breakdown not available")
          </details>

          ## ğŸ† GitHub Trophies

          ## ğŸ”§ Technologies & Tools

          ## ğŸ“ˆ Contribution Graph

          ## ğŸ’¼ Featured Projects

          ## ğŸ”— Connect with me

          <!--START_SECTION:activity-->
          <!--END_SECTION:activity-->

          EOF

      - name: Update recent GitHub activity
        uses: jamesgeorge007/github-activity-readme@master
        continue-on-error: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          COMMIT_MSG: 'Update README with recent activity'
          MAX_LINES: 5

      # ... æ®‹ã‚Šã®ã‚¹ãƒ†ãƒƒãƒ—ã¯å¤‰æ›´ãªã— ...
